version: "3.9"

services:
    postgres:
        image: postgres:17.2                # PostgreSQL 17.2 이미지 사용
        container_name: invest-postgres     # 컨테이너 이름을 invest-postgres로 고정
        restart: unless-stopped             # 사용자가 직접 중지하지 않는 한 자동 재시작

        ports:
            - "5432:5432"                   # 호스트 5432 포트를 컨테이너 5432 포트에 연결

        environment:
            POSTGRES_DB: invest_asset_mgr   # 생성할 데이터베이스 이름
            POSTGRES_USER: invest           # postgres 접속 사용자 이름
            POSTGRES_PASSWORD: invest       # postgres 접속 비밀번호

        volumes:
            - ~/_docVol/inv_pgdata:/var/lib/postgresql/data   # 호스트 inv_pgdata 폴더를 DB 데이터 경로로 연결

        healthcheck:
            test: ["CMD-SHELL", "pg_isready -U invest"]    # postgres 준비 상태 확인
            interval: 10s                  # 헬스체크 실행 간격
            timeout: 5s                    # 헬스체크 타임아웃
            retries: 5                     # 실패 시 재시도 횟수